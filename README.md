# OpenFinance

<div align="center">

![Version](https://img.shields.io/badge/version-3.1.0-blue.svg)
![Python](https://img.shields.io/badge/python-3.11+-green.svg)
![TypeScript](https://img.shields.io/badge/typescript-5.0+-blue.svg)
![License](https://img.shields.io/badge/license-MIT-orange.svg)

**åŸºäºå¤§è¯­è¨€æ¨¡å‹çš„æ™ºèƒ½é‡‘èåˆ†æå¹³å°**

[åŠŸèƒ½ç‰¹æ€§](#åŠŸèƒ½ç‰¹æ€§) â€¢ [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹) â€¢ [æŠ€æœ¯æ¶æ„](#æŠ€æœ¯æ¶æ„) â€¢ [APIæ–‡æ¡£](#apiæ–‡æ¡£) â€¢ [éƒ¨ç½²æŒ‡å—](#éƒ¨ç½²æŒ‡å—)

</div>

---

## ğŸ“– é¡¹ç›®ç®€ä»‹

OpenFinanceï¼ˆWaveletTraderï¼‰æ˜¯ä¸€ä¸ªåŸºäºå¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰çš„æ™ºèƒ½é‡‘èåˆ†æå¹³å°ï¼Œæ—¨åœ¨ä¸ºæŠ•èµ„è€…æä¾›ä¸“ä¸šã€æ™ºèƒ½ã€ä¸ªæ€§åŒ–çš„é‡‘èåˆ†ææœåŠ¡ã€‚å¹³å°èåˆäº†äººå·¥æ™ºèƒ½ã€çŸ¥è¯†å›¾è°±ã€å®æ—¶æ•°æ®ç­‰æŠ€æœ¯ï¼Œå®ç°ä»æ•°æ®é‡‡é›†ã€åˆ†æã€åˆ°æ™ºèƒ½é—®ç­”çš„å…¨é“¾è·¯é‡‘èæœåŠ¡ã€‚

### æ ¸å¿ƒä»·å€¼

| ä»·å€¼ä¸»å¼  | æè¿° |
|----------|------|
| **æ™ºèƒ½åˆ†æ** | åŸºäºLLMçš„æ™ºèƒ½é—®ç­”å’Œæ·±åº¦åˆ†æèƒ½åŠ› |
| **ä¸“ä¸šè§†è§’** | æ¨¡æ‹ŸæŠ•èµ„å¤§å¸ˆï¼ˆå·´è²ç‰¹ã€è¾¾é‡Œå¥¥ç­‰ï¼‰çš„æŠ•èµ„è§‚ç‚¹ |
| **å®æ—¶æ•°æ®** | å¯¹æ¥å¤šæ•°æ®æºï¼Œæä¾›å®æ—¶å¸‚åœºæ•°æ® |
| **çŸ¥è¯†å›¾è°±** | æ„å»ºé‡‘èé¢†åŸŸçŸ¥è¯†å›¾è°±ï¼Œæ”¯æŒå…³è”åˆ†æ |
| **å¯è§†åŒ–** | ä¸°å¯Œçš„å›¾è¡¨å±•ç¤ºï¼Œç›´è§‚å‘ˆç°åˆ†æç»“æœ |

---

## âœ¨ åŠŸèƒ½ç‰¹æ€§

### ğŸ¤– æ™ºèƒ½é—®ç­”

åŸºäºè‡ªç„¶è¯­è¨€çš„æ™ºèƒ½é‡‘èé—®ç­”ç³»ç»Ÿï¼Œæ”¯æŒå¤šç§æŸ¥è¯¢ç±»å‹ï¼š

- **è‚¡ç¥¨æœç´¢**: "æµ¦å‘é“¶è¡Œçš„å¸‚ç›ˆç‡æ˜¯å¤šå°‘"
- **è‚¡ç¥¨åˆ†æ**: "åˆ†æä¸€ä¸‹è´µå·èŒ…å°çš„æŠ•èµ„ä»·å€¼"
- **è¡Œä¸šåˆ†æ**: "é“¶è¡Œä¸šçš„å‘å±•è¶‹åŠ¿å¦‚ä½•"
- **å®è§‚åˆ†æ**: "ä¸­å›½GDPå¢é•¿ç‡æ˜¯å¤šå°‘"
- **è§’è‰²è§‚ç‚¹**: "å·´è²ç‰¹æ€ä¹ˆçœ‹æ¯”äºšè¿ª"
- **è‚¡ç¥¨æ’å**: "å¸‚ç›ˆç‡æœ€ä½çš„é“¶è¡Œè‚¡æœ‰å“ªäº›"

#### æ–°ç‰¹æ€§

| ç‰¹æ€§ | æè¿° |
|------|------|
| **æµå¼Markdownæ¸²æŸ“** | ä½¿ç”¨Streamdownç»„ä»¶ä¼˜é›…å¤„ç†ä¸å®Œæ•´çš„Markdownå†…å®¹ |
| **å·¥å…·è°ƒç”¨å±•ç¤º** | æ˜¾ç¤ºå·¥å…·åç§°ã€å‚æ•°ã€æ‰§è¡Œç»“æœå’Œè€—æ—¶ |
| **StopæŒ‰é’®** | æ”¯æŒéšæ—¶åœæ­¢ç”Ÿæˆï¼Œè°ƒç”¨åç«¯åœæ­¢æ¥å£ |
| **æ€è€ƒè¿‡ç¨‹å±•ç¤º** | æ˜¾ç¤ºAIæ€è€ƒè¿‡ç¨‹ï¼Œå¢å¼ºå¯è§£é‡Šæ€§ |

### ğŸ­ è§’è‰²æ‰®æ¼”

æ¨¡æ‹ŸæŠ•èµ„å¤§å¸ˆçš„æŠ•èµ„é£æ ¼å’Œè§‚ç‚¹ï¼š

| è§’è‰² | æŠ•èµ„é£æ ¼ | æ ¸å¿ƒç†å¿µ |
|------|----------|----------|
| æ²ƒä¼¦Â·å·´è²ç‰¹ | ä»·å€¼æŠ•èµ„ | é•¿æœŸæŒæœ‰ã€å®‰å…¨è¾¹é™…ã€æŠ¤åŸæ²³ |
| ç‘Â·è¾¾é‡Œå¥¥ | å…¨å¤©å€™ç­–ç•¥ | é£é™©å¹³ä»·ã€å¤šå…ƒåŒ–é…ç½®ã€ç»æµå‘¨æœŸ |
| å‡¯ç‘Ÿç³Â·ä¼å¾· | åˆ›æ–°æŠ•èµ„ | é¢ è¦†æ€§åˆ›æ–°ã€ä¸»é¢˜æŠ•èµ„ã€é•¿æœŸæˆé•¿ |

### ğŸ“Š æ•°æ®åˆ†æ

- **è‚¡ç¥¨åˆ†æ**: ä¼°å€¼åˆ†æã€åŸºæœ¬é¢åˆ†æã€æŠ€æœ¯é¢åˆ†æ
- **è¡Œä¸šåˆ†æ**: è¡Œä¸šå¯¹æ¯”ã€äº§ä¸šé“¾åˆ†æã€æ™¯æ°”åº¦è·Ÿè¸ª
- **å®è§‚åˆ†æ**: GDPã€CPIã€PMIç­‰å®è§‚æŒ‡æ ‡
- **æ–°é—»èµ„è®¯**: è´¢ç»æ–°é—»ã€å…¬å‘Šé€Ÿé€’ã€ç ”æŠ¥ç²¾é€‰

### ğŸ—ï¸ ç»Ÿä¸€ç±»å‹ç³»ç»Ÿ

é‡‡ç”¨ **YAMLé©±åŠ¨çš„ç±»å‹å®šä¹‰**ï¼Œå®ç°å•ä¸€æ•°æ®æºï¼š

```python
from openfinance.domain.types import EntityType, get_entity_label

# è·å–å®ä½“ç±»å‹
entity_type = EntityType.COMPANY  # "company"

# è·å–ä¸­æ–‡æ ‡ç­¾
label = get_entity_label("company")  # "å…¬å¸"

# éªŒè¯ç±»å‹
is_valid = is_valid_entity_type("stock")  # True
```

### ğŸ”§ ç³»ç»Ÿç®¡ç†

- **Agentç®¡ç†**: æ™ºèƒ½ä»£ç†çš„åˆ›å»ºã€é…ç½®ã€ç›‘æ§
- **æŠ€èƒ½ç®¡ç†**: æŠ€èƒ½æ³¨å†Œã€ç”Ÿå‘½å‘¨æœŸç®¡ç†
- **å·¥å…·ç®¡ç†**: å·¥å…·æ³¨å†Œã€è°ƒç”¨ã€ç¼–æ’
- **æµç¨‹ç¼–æ’**: å·¥ä½œæµè®¾è®¡ã€æ‰§è¡Œã€ç›‘æ§

---

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           OpenFinance æŠ€æœ¯æ¶æ„                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                         å‰ç«¯åº”ç”¨å±‚                                  â”‚ â”‚
â”‚  â”‚                    Next.js 14 + React 18                          â”‚ â”‚
â”‚  â”‚              TailwindCSS + Radix UI + ECharts                     â”‚ â”‚
â”‚  â”‚                    Streamdown (Markdownæ¸²æŸ“)                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                   â”‚                                     â”‚
â”‚                                   â–¼                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                         APIç½‘å…³å±‚                                   â”‚ â”‚
â”‚  â”‚                      FastAPI + WebSocket                           â”‚ â”‚
â”‚  â”‚              è®¤è¯æˆæƒ / é™æµ / æ—¥å¿— / ç›‘æ§                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                   â”‚                                     â”‚
â”‚                                   â–¼                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                         ä¸šåŠ¡æœåŠ¡å±‚                                  â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚  Agentå¼•æ“  â”‚  æŠ€èƒ½ç®¡ç†   â”‚  å·¥å…·è°ƒç”¨   â”‚  æ„å›¾è¯†åˆ«   â”‚ çŸ¥è¯†å›¾è°±  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                   â”‚                                     â”‚
â”‚                                   â–¼                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                         é¢†åŸŸç±»å‹å±‚                                  â”‚ â”‚
â”‚  â”‚              YAMLé©±åŠ¨ + åŠ¨æ€åŠ è½½ + ç±»å‹å®‰å…¨                         â”‚ â”‚
â”‚  â”‚           EntityType / RelationType / FactorType                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                   â”‚                                     â”‚
â”‚                                   â–¼                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                         LLMå¼•æ“å±‚                                   â”‚ â”‚
â”‚  â”‚              OpenAI / Claude / Qwen                                â”‚ â”‚
â”‚  â”‚           LangGraph / LangChain / Promptç®¡ç†                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                   â”‚                                     â”‚
â”‚                                   â–¼                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                         æ•°æ®æœåŠ¡å±‚                                  â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚  è¡Œæƒ…æ•°æ®   â”‚  è´¢åŠ¡æ•°æ®   â”‚  æ–°é—»æ•°æ®   â”‚  çŸ¥è¯†å›¾è°±   â”‚ å‘é‡å­˜å‚¨  â”‚ â”‚
â”‚  â”‚   AKShare   â”‚   Tushare   â”‚   RSS/API   â”‚   Neo4j     â”‚ Milvus   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æŠ€æœ¯æ ˆ

#### åç«¯

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| Python | 3.11+ | ä¸»è¦å¼€å‘è¯­è¨€ |
| FastAPI | 0.109+ | Webæ¡†æ¶ |
| LangGraph | 0.2+ | Agentç¼–æ’ |
| LangChain | 0.2+ | LLMåº”ç”¨æ¡†æ¶ |
| Pydantic | 2.5+ | æ•°æ®éªŒè¯ |
| Redis | 7.0+ | ç¼“å­˜/æ¶ˆæ¯é˜Ÿåˆ— |
| PostgreSQL | 15+ | å…³ç³»å‹æ•°æ®åº“ |
| Neo4j | 5.0+ | çŸ¥è¯†å›¾è°± |
| Milvus | 2.3+ | å‘é‡æ•°æ®åº“ |

#### å‰ç«¯

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| Next.js | 14.2+ | Reactæ¡†æ¶ |
| React | 18.2+ | UIåº“ |
| TypeScript | 5.0+ | ç±»å‹ç³»ç»Ÿ |
| TailwindCSS | 3.4+ | æ ·å¼æ¡†æ¶ |
| Radix UI | 1.0+ | æ— éšœç¢ç»„ä»¶åº“ |
| ECharts | 5.4+ | å›¾è¡¨åº“ |
| Streamdown | 2.3+ | æµå¼Markdownæ¸²æŸ“ |
| Zustand | 4.4+ | çŠ¶æ€ç®¡ç† |
| Axios | 1.6+ | HTTPå®¢æˆ·ç«¯ |

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Python 3.11+
- Node.js 18+
- Docker & Docker Compose (å¯é€‰)
- Redis 7.0+
- PostgreSQL 15+

### æœ¬åœ°å¼€å‘

#### 1. å…‹éš†é¡¹ç›®

```bash
git clone https://github.com/your-org/openfinance.git
cd openfinance
```

#### 2. åç«¯è®¾ç½®

```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
cd backend
python -m venv venv
source venv/bin/activate  # Linux/macOS
# venv\Scripts\activate  # Windows

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# é…ç½®ç¯å¢ƒå˜é‡
cp ../.env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œé…ç½®å¿…è¦çš„APIå¯†é’¥å’Œæ•°æ®åº“è¿æ¥

# å¯åŠ¨åç«¯æœåŠ¡
python -m uvicorn openfinance.api.main:app --reload --port 8000
```

#### 3. å‰ç«¯è®¾ç½®

```bash
# æ‰“å¼€æ–°ç»ˆç«¯
cd frontend

# å®‰è£…ä¾èµ–
npm install

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev
```

#### 4. è®¿é—®åº”ç”¨

- å‰ç«¯: http://localhost:3000
- APIæ–‡æ¡£: http://localhost:8000/docs
- ReDoc: http://localhost:8000/redoc

### Dockeréƒ¨ç½²

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# åœæ­¢æœåŠ¡
docker-compose down
```

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
openfinance/
â”œâ”€â”€ backend/                    # åç«¯æœåŠ¡
â”‚   â”œâ”€â”€ openfinance/
â”‚   â”‚   â”œâ”€â”€ api/               # APIè·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ routes/        # è·¯ç”±æ¨¡å—
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ chat.py    # èŠå¤©API (å«stream/stop)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ health.py  # å¥åº·æ£€æŸ¥
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ intent.py  # æ„å›¾è¯†åˆ«
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ skills.py  # æŠ€èƒ½ç®¡ç†
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ tools.py   # å·¥å…·ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ main.py        # FastAPIåº”ç”¨
â”‚   â”‚   â”‚   â””â”€â”€ websocket.py   # WebSocketå¤„ç†
â”‚   â”‚   â”œâ”€â”€ agents/            # Agentæ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ core/          # æ ¸å¿ƒå¼•æ“
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ loop.py    # Agentå¾ªç¯ (å«tool_call_id)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ graph.py   # LangGraphç¼–æ’
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ state.py   # çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”‚   â””â”€â”€ tools/         # å·¥å…·å®šä¹‰
â”‚   â”‚   â”‚       â””â”€â”€ builtin.py # å†…ç½®å·¥å…· (stock_priceç­‰)
â”‚   â”‚   â”œâ”€â”€ domain/            # é¢†åŸŸæ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ types/         # ç»Ÿä¸€ç±»å‹ç³»ç»Ÿ (æ–°å¢)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ entity.py  # EntityType
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ relation.py # RelationType
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ converters.py # ç±»å‹è½¬æ¢
â”‚   â”‚   â”‚   â”œâ”€â”€ models/        # Pydanticæ¨¡å‹
â”‚   â”‚   â”‚   â””â”€â”€ metadata/      # å…ƒæ•°æ®é…ç½®
â”‚   â”‚   â”‚       â”œâ”€â”€ config/    # YAMLé…ç½®
â”‚   â”‚   â”‚       â”œâ”€â”€ loader.py  # YAMLåŠ è½½å™¨
â”‚   â”‚   â”‚       â””â”€â”€ registry.py # ç±»å‹æ³¨å†Œä¸­å¿ƒ
â”‚   â”‚   â”œâ”€â”€ datacenter/        # æ•°æ®ä¸­å¿ƒ
â”‚   â”‚   â”‚   â”œâ”€â”€ collector/     # æ•°æ®é‡‡é›†
â”‚   â”‚   â”‚   â”œâ”€â”€ processor/     # æ•°æ®å¤„ç†
â”‚   â”‚   â”‚   â””â”€â”€ models/        # ORMæ¨¡å‹
â”‚   â”‚   â”‚       â””â”€â”€ orm.py     # SQLAlchemyæ¨¡å‹
â”‚   â”‚   â””â”€â”€ infrastructure/    # åŸºç¡€è®¾æ–½
â”‚   â”‚       â””â”€â”€ database/      # æ•°æ®åº“è¿æ¥
â”‚   â”œâ”€â”€ tests/                 # æµ‹è¯•æ–‡ä»¶
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â””â”€â”€ pyproject.toml
â”‚
â”œâ”€â”€ frontend/                   # å‰ç«¯åº”ç”¨
â”‚   â”œâ”€â”€ app/                    # Next.js App Router
â”‚   â”‚   â”œâ”€â”€ finchat/           # é‡‘èèŠå¤©é¡µé¢
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx       # ä¸»é¡µé¢ (å«StopæŒ‰é’®)
â”‚   â”‚   â”œâ”€â”€ layout.tsx         # æ ¹å¸ƒå±€
â”‚   â”‚   â”œâ”€â”€ page.tsx           # é¦–é¡µ
â”‚   â”‚   â””â”€â”€ globals.css        # å…¨å±€æ ·å¼
â”‚   â”œâ”€â”€ components/            # ç»„ä»¶
â”‚   â”‚   â””â”€â”€ ui/                # UIç»„ä»¶
â”‚   â”‚       â”œâ”€â”€ button.tsx
â”‚   â”‚       â”œâ”€â”€ card.tsx
â”‚   â”‚       â”œâ”€â”€ badge.tsx
â”‚   â”‚       â””â”€â”€ StreamMarkdown.tsx # æµå¼Markdownæ¸²æŸ“ (æ–°å¢)
â”‚   â”œâ”€â”€ services/              # æœåŠ¡å±‚
â”‚   â”‚   â”œâ”€â”€ apiConfig.ts       # APIé…ç½®
â”‚   â”‚   â””â”€â”€ FinchatServices/   # èŠå¤©æœåŠ¡
â”‚   â”‚       â””â”€â”€ index.ts       # å«stopGenerationæ–¹æ³•
â”‚   â”œâ”€â”€ tests/                 # E2Eæµ‹è¯•
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ tsconfig.json
â”‚
â”œâ”€â”€ .env.example               # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ docker-compose.yml         # Dockerç¼–æ’
â”œâ”€â”€ ARCHITECTURE.md            # æ¶æ„æ–‡æ¡£
â””â”€â”€ README.md                  # é¡¹ç›®è¯´æ˜
```

---

## ğŸ”Œ APIæ–‡æ¡£

### æ ¸å¿ƒAPIç«¯ç‚¹

#### å¥åº·æ£€æŸ¥

```http
GET /api/health
GET /api/health/ready
GET /api/health/live
```

#### æ™ºèƒ½é—®ç­”ï¼ˆæµå¼ï¼‰

```http
POST /api/chat/stream
Content-Type: application/json

{
  "meta": {
    "trace_id": "unique-trace-id",
    "source": "web",
    "platform": "web"
  },
  "user": {
    "ldap_id": "user123",
    "user_name": "å¼ ä¸‰",
    "role": "user"
  },
  "query": "æµ¦å‘é“¶è¡Œçš„å¸‚ç›ˆç‡æ˜¯å¤šå°‘"
}
```

**SSEäº‹ä»¶ç±»å‹:**

| äº‹ä»¶ç±»å‹ | æè¿° |
|----------|------|
| `thinking` | AIæ€è€ƒè¿‡ç¨‹ |
| `progress` | å·¥å…·æ‰§è¡Œè¿›åº¦ (å«tool_call_id) |
| `tool_result` | å·¥å…·æ‰§è¡Œç»“æœ (å«tool_call_id) |
| `content` | æµå¼å†…å®¹è¾“å‡º |
| `final` | æœ€ç»ˆç»“æœ |

#### åœæ­¢ç”Ÿæˆ

```http
POST /api/chat/stop
Content-Type: application/json

{
  "user": {
    "ldap_id": "user123"
  }
}
```

#### è§’è‰²å¯¹è¯

```http
POST /api/chat/role/{role_id}
Content-Type: application/json

{
  "query": "ä½ æ€ä¹ˆçœ‹æ¯”äºšè¿ª",
  "role": "warren_buffett"
}
```

#### æ„å›¾è¯†åˆ«

```http
POST /api/intent?query=æµ¦å‘é“¶è¡Œçš„å¸‚ç›ˆç‡æ˜¯å¤šå°‘
```

#### å·¥å…·ç®¡ç†

```http
GET /api/tools                    # åˆ—å‡ºæ‰€æœ‰å·¥å…·
GET /api/tools/{tool_name}        # è·å–å·¥å…·è¯¦æƒ…
POST /api/tools/{tool_name}/invoke # è°ƒç”¨å·¥å…·
GET /api/tools/openai/format      # OpenAIæ ¼å¼å·¥å…·åˆ—è¡¨
```

#### æŠ€èƒ½ç®¡ç†

```http
GET /api/skills                   # åˆ—å‡ºæ‰€æœ‰æŠ€èƒ½
GET /api/skills/{skill_id}        # è·å–æŠ€èƒ½è¯¦æƒ…
GET /api/skills/stats/summary     # æŠ€èƒ½ç»Ÿè®¡
```

#### å…ƒæ•°æ®ç±»å‹

```http
GET /api/metadata/entity-types    # è·å–å®ä½“ç±»å‹
GET /api/metadata/relation-types  # è·å–å…³ç³»ç±»å‹
```

å®Œæ•´APIæ–‡æ¡£è¯·è®¿é—®: http://localhost:8000/docs

---

## ğŸ§ª æµ‹è¯•

### åç«¯æµ‹è¯•

```bash
cd backend

# è¿è¡Œæ‰€æœ‰æµ‹è¯•
python -m pytest

# è¿è¡Œç‰¹å®šæµ‹è¯•
python -m pytest tests/test_api_integration.py -v

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
python -m pytest --cov=openfinance --cov-report=html
```

### å‰ç«¯æµ‹è¯•

```bash
cd frontend

# è¿è¡ŒE2Eæµ‹è¯•
npm run test:e2e

# UIæ¨¡å¼è¿è¡Œæµ‹è¯•
npm run test:e2e:ui

# è¿è¡Œç±»å‹æ£€æŸ¥
npm run type-check

# è¿è¡Œä»£ç æ£€æŸ¥
npm run lint
```

---

## ğŸ“¦ éƒ¨ç½²æŒ‡å—

### ç”Ÿäº§ç¯å¢ƒé…ç½®

1. **ç¯å¢ƒå˜é‡é…ç½®**

```bash
# .env.production
NODE_ENV=production
API_URL=https://api.openfinance.com
DATABASE_URL=postgresql://user:pass@host:5432/db
REDIS_URL=redis://host:6379
OPENAI_API_KEY=sk-xxx
```

2. **æ„å»ºå‰ç«¯**

```bash
cd frontend
npm run build
npm run start
```

3. **æ„å»ºåç«¯**

```bash
cd backend
docker build -t openfinance-backend .
docker run -p 8000:8000 openfinance-backend
```

### Kuberneteséƒ¨ç½²

```yaml
# k8s/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: openfinance
spec:
  replicas: 3
  selector:
    matchLabels:
      app: openfinance
  template:
    spec:
      containers:
      - name: backend
        image: openfinance-backend:latest
        ports:
        - containerPort: 8000
      - name: frontend
        image: openfinance-frontend:latest
        ports:
        - containerPort: 3000
```

---

## ğŸ”’ å®‰å…¨

### è®¤è¯æˆæƒ

- JWT Tokenè®¤è¯
- OAuth2.0é›†æˆ
- RBACæƒé™æ§åˆ¶

### æ•°æ®å®‰å…¨

- æ•æ„Ÿæ•°æ®åŠ å¯†å­˜å‚¨
- APIå¯†é’¥å®‰å…¨ç®¡ç†
- SQLæ³¨å…¥é˜²æŠ¤
- XSS/CSRFé˜²æŠ¤

### å®‰å…¨æœ€ä½³å®è·µ

```python
# ç¯å¢ƒå˜é‡ç®¡ç†æ•æ„Ÿä¿¡æ¯
from pydantic_settings import BaseSettings

class Settings(BaseSettings):
    openai_api_key: str
    database_url: str
    redis_url: str
    
    class Config:
        env_file = ".env"

settings = Settings()
```

---

## ğŸ“ˆ ç›‘æ§ä¸æ—¥å¿—

### å¥åº·æ£€æŸ¥

```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
curl http://localhost:8000/api/health

# å°±ç»ªæ£€æŸ¥
curl http://localhost:8000/api/health/ready

# å­˜æ´»æ£€æŸ¥
curl http://localhost:8000/api/health/live
```

### æ—¥å¿—é…ç½®

```python
import logging

logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'
)
```

---

## ğŸ¤ è´¡çŒ®æŒ‡å—

æˆ‘ä»¬æ¬¢è¿æ‰€æœ‰å½¢å¼çš„è´¡çŒ®ï¼

### å¼€å‘æµç¨‹

1. Fork é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. æäº¤ Pull Request

### ä»£ç è§„èŒƒ

- Python: éµå¾ª PEP 8 è§„èŒƒ
- TypeScript: ä½¿ç”¨ ESLint + Prettier
- æäº¤ä¿¡æ¯: éµå¾ª Conventional Commits

---

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶

---

## ğŸ“ è”ç³»æ–¹å¼

- é¡¹ç›®ä¸»é¡µ: https://github.com/your-org/openfinance
- é—®é¢˜åé¦ˆ: https://github.com/your-org/openfinance/issues
- é‚®ç®±: openfinance@example.com

---

## ğŸ™ è‡´è°¢

æ„Ÿè°¢ä»¥ä¸‹å¼€æºé¡¹ç›®ï¼š

- [FastAPI](https://fastapi.tiangolo.com/)
- [Next.js](https://nextjs.org/)
- [LangChain](https://langchain.com/)
- [LangGraph](https://langchain-ai.github.io/langgraph/)
- [Streamdown](https://github.com/vercel/streamdown)
- [AKShare](https://akshare.akfamily.xyz/)
- [Tushare](https://tushare.pro/)

---

<div align="center">

**â­ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸€ä¸ª Star â­**

Made with â¤ï¸ by OpenFinance Team

</div>
