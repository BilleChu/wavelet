# Comprehensive Optimization Plan for Wavelet Project

## Part 1: Code Quality Assessment and Refactoring

### 1.1 Remove Unused/Dead Code
- **Clean up duplicate function definitions** in `chat.py`:
  - Remove duplicate `get_instance()` (lines 84-88 vs 148-152)
  - Remove duplicate `list_skills()` (lines 704-721 vs 752-769)
  - Remove duplicate `get_chat_suggestions()` (3 occurrences)
- **Remove empty pass statements** (30+ instances) in pipeline, strategy, and collector modules
- **Clean up unused model directories** with inline-only definitions

### 1.2 Fix Code Duplication
- **Create shared utility module** `backend/openfinance/datacenter/utils/converters.py`:
  - Extract `_safe_float()`, `_safe_int()`, `_get_code_id()` (duplicated 38+ times)
  - Consolidate `formatPercent` and `formatNumber` from frontend
- **Refactor collectors** to use shared utilities via dependency injection

### 1.3 Improve Readability & Maintainability
- **Refactor large files**:
  - Split `quant/page.tsx` (1588 lines) into smaller components
  - Split `chat.py` into service classes
- **Add proper docstrings** to public methods
- **Standardize error handling** across services

### 1.4 Performance Optimizations
- **Add HTTP connection pooling** for collectors (currently creating new sessions per request)
- **Implement proper caching layer** using existing Redis
- **Optimize database queries** with proper indexing

---

## Part 2: Data Logic Optimization

### 2.1 Integrate Data Lifecycle Components
- **Map data flow**: Collector → Pipeline → Quality → Model → Storage → Service
- **Create unified data orchestration** using existing Pipeline framework
- **Implement ModelAwareCollector/Service** integration (already created)

### 2.2 Workflow Optimization
- **Create standardized data ingestion workflow**:
  1. Data Collection (via Collector)
  2. Quality Validation (via QualityChecker)
  3. Model Transformation (via ModelTransformer)
  4. Persistence (via ModelAwarePersistence)
  5. Service Exposure (via ModelAwareService)

### 2.3 Scalability Improvements
- **Implement batch processing** for large datasets
- **Add async processing** with Celery task queue
- **Create data partitioning** strategy for TimescaleDB

---

## Part 3: Frontend UX Enhancement

### 3.1 UI/UX Improvements
- **Implement global state management** with Zustand (installed but unused)
- **Add loading skeletons** for each route (`loading.tsx`)
- **Implement React Error Boundaries** for graceful error handling
- **Add toast notification system** for user feedback

### 3.2 Performance Optimizations
- **Code splitting** for large components
- **Image optimization** with Next.js Image component
- **Lazy loading** for non-critical components
- **API response caching** with React Query or SWR

### 3.3 New Features
- **Real-time data updates** via WebSocket/SSE
- **Dark/Light theme toggle** (currently dark-only)
- **Improved mobile responsiveness**
- **Keyboard shortcuts** for power users

---

## Part 4: Comprehensive Testing

### 4.1 Backend Testing
- **Add unit tests** for:
  - Collector utilities (safe_float, safe_int)
  - Model transformer
  - Quality checker
- **Add integration tests** for:
  - Full data pipeline flow
  - API endpoints
- **Add performance tests** for API endpoints

### 4.2 Frontend Testing
- **Add component tests** with Vitest + React Testing Library
- **Expand E2E tests** for:
  - Data center workflows
  - Quant analysis workflows
  - Knowledge graph interactions
- **Add visual regression tests** for UI components

### 4.3 Cross-browser & Responsive Testing
- **Expand Playwright projects** for Safari/Firefox
- **Add responsive design tests** for all breakpoints
- **Create test fixtures** for consistent test data

### 4.4 CI/CD Integration
- **Create GitHub Actions workflow** for automated testing
- **Add coverage reporting** to PR checks
- **Set up test result artifacts**

---

## Implementation Priority

| Phase | Tasks | Estimated Effort |
|-------|-------|------------------|
| 1.1-1.2 | Code cleanup & deduplication | High |
| 1.3-1.4 | Readability & performance | Medium |
| 2.1-2.3 | Data logic optimization | High |
| 3.1-3.3 | Frontend enhancement | Medium |
| 4.1-4.4 | Testing infrastructure | Medium |

**Total Estimated Files Modified**: ~50+ files
**New Files Created**: ~15 files (utilities, tests, components)