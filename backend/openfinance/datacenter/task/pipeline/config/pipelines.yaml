# Pipeline Configuration
# Defines data collection pipelines with tasks and dependencies

pipelines:
  daily_basic_sync:
    name: "Daily Basic Data Sync"
    description: "Sync daily basic data including stock info, industry, concept"
    enabled: true
    schedule:
      type: cron
      expression: "0 9 * * *"
      timezone: "Asia/Shanghai"
    max_concurrent_tasks: 5
    timeout_seconds: 3600
    tasks:
      - task_id: sync_stock_basic
        name: "Sync Stock Basic Info"
        task_type: stock_basic_info
        priority: high
        timeout_seconds: 300
        max_retries: 3
        params: {}
        dependencies: []

      - task_id: sync_industry
        name: "Sync Industry Data"
        task_type: industry_classify
        priority: normal
        timeout_seconds: 300
        max_retries: 3
        params: {}
        dependencies:
          - sync_stock_basic

      - task_id: sync_concept
        name: "Sync Concept Data"
        task_type: concept_classify
        priority: normal
        timeout_seconds: 300
        max_retries: 3
        params: {}
        dependencies:
          - sync_stock_basic

      - task_id: sync_daily_basic
        name: "Sync Daily Basic"
        task_type: daily_basic
        priority: normal
        timeout_seconds: 300
        max_retries: 3
        params: {}
        dependencies:
          - sync_stock_basic

  intraday_collection:
    name: "Intraday Data Collection"
    description: "Collect real-time market data during trading hours"
    enabled: true
    schedule:
      type: interval
      expression: "300"
    max_concurrent_tasks: 5
    timeout_seconds: 600
    tasks:
      - task_id: collect_realtime
        name: "Collect Realtime Quotes"
        task_type: market_realtime
        priority: high
        timeout_seconds: 120
        max_retries: 2
        params: {}
        dependencies: []

      - task_id: collect_tick
        name: "Collect Tick Data"
        task_type: tick_data
        priority: normal
        timeout_seconds: 180
        max_retries: 2
        params: {}
        dependencies:
          - collect_realtime

  daily_post_market:
    name: "Daily Post-Market Collection"
    description: "Collect daily data after market close"
    enabled: true
    schedule:
      type: cron
      expression: "0 16 * * *"
      timezone: "Asia/Shanghai"
    max_concurrent_tasks: 5
    timeout_seconds: 3600
    tasks:
      - task_id: collect_daily_quotes
        name: "Collect Daily Quotes"
        task_type: daily_quotes
        priority: high
        timeout_seconds: 300
        max_retries: 3
        params: {}
        dependencies: []

      - task_id: collect_financial_indicator
        name: "Collect Financial Indicators"
        task_type: financial_indicator
        priority: normal
        timeout_seconds: 300
        max_retries: 3
        params: {}
        dependencies:
          - collect_daily_quotes

      - task_id: collect_income
        name: "Collect Income Statement"
        task_type: income_statement
        priority: normal
        timeout_seconds: 300
        max_retries: 3
        params: {}
        dependencies:
          - collect_daily_quotes

      - task_id: collect_balance
        name: "Collect Balance Sheet"
        task_type: balance_sheet
        priority: normal
        timeout_seconds: 300
        max_retries: 3
        params: {}
        dependencies:
          - collect_daily_quotes

  knowledge_graph_sync:
    name: "Knowledge Graph Sync"
    description: "Sync entities to knowledge graph"
    enabled: true
    schedule:
      type: cron
      expression: "0 10 * * *"
      timezone: "Asia/Shanghai"
    max_concurrent_tasks: 5
    timeout_seconds: 3600
    tasks:
      - task_id: sync_company_entities
        name: "Sync Company Entities"
        task_type: sync_company_entities
        priority: high
        timeout_seconds: 300
        max_retries: 3
        params: {}
        dependencies: []

      - task_id: sync_stock_entities
        name: "Sync Stock Entities"
        task_type: sync_stock_entities
        priority: high
        timeout_seconds: 600
        max_retries: 3
        params:
          batch_size: 1000
        dependencies:
          - sync_company_entities

      - task_id: sync_industry_entities
        name: "Sync Industry Entities"
        task_type: sync_industry_entities
        priority: normal
        timeout_seconds: 300
        max_retries: 3
        params: {}
        dependencies:
          - sync_company_entities

      - task_id: sync_concept_entities
        name: "Sync Concept Entities"
        task_type: sync_concept_entities
        priority: normal
        timeout_seconds: 300
        max_retries: 3
        params: {}
        dependencies:
          - sync_company_entities

  historical_data_sync:
    name: "Historical Data Sync (2 Years)"
    description: "Sync 2 years of historical trading data to database"
    enabled: true
    schedule:
      type: manual
    max_concurrent_tasks: 3
    timeout_seconds: 7200
    tasks:
      - task_id: sync_stock_basic
        name: "Sync Stock Basic Info"
        task_type: stock_basic_info
        priority: critical
        timeout_seconds: 300
        max_retries: 3
        params:
          market: "沪深A"
        dependencies: []

      - task_id: sync_daily_quotes_2y
        name: "Sync 2 Years Daily Quotes"
        task_type: stock_daily_quote
        priority: high
        timeout_seconds: 7200
        max_retries: 3
        params:
          days: 730
        dependencies:
          - sync_stock_basic

      - task_id: sync_index_quotes_2y
        name: "Sync 2 Years Index Quotes"
        task_type: index_daily_quote
        priority: high
        timeout_seconds: 600
        max_retries: 3
        params:
          codes:
            - "000001"
            - "399001"
            - "399006"
            - "000300"
            - "000905"
            - "000016"
          days: 730
        dependencies: []

      - task_id: sync_north_money
        name: "Sync North Money Flow"
        task_type: north_money
        priority: normal
        timeout_seconds: 300
        max_retries: 3
        params: {}
        dependencies:
          - sync_daily_quotes_2y

      - task_id: sync_financial_indicator
        name: "Sync Financial Indicators"
        task_type: financial_indicator
        priority: normal
        timeout_seconds: 1200
        max_retries: 3
        params: {}
        dependencies:
          - sync_stock_basic

      - task_id: sync_knowledge_graph
        name: "Sync to Knowledge Graph"
        task_type: sync_stock_entities
        priority: low
        timeout_seconds: 600
        max_retries: 3
        params:
          batch_size: 500
        dependencies:
          - sync_stock_basic

  factor_compute_daily:
    name: "Daily Factor Computation"
    description: "Calculate all technical and fundamental factors for stocks"
    enabled: true
    schedule:
      type: cron
      expression: "0 17 * * *"
      timezone: "Asia/Shanghai"
    max_concurrent_tasks: 3
    timeout_seconds: 7200
    tasks:
      - task_id: compute_technical_factors
        name: "Compute Technical Factors"
        task_type: factor_compute
        priority: high
        timeout_seconds: 3600
        max_retries: 2
        params:
          factor_ids:
            - "factor_momentum"
            - "factor_risk_adj_momentum"
            - "factor_volatility"
            - "factor_idio_volatility"
            - "factor_sma"
            - "factor_ema"
            - "factor_macd"
            - "factor_rsi"
            - "factor_kdj"
            - "factor_boll"
            - "factor_atr"
            - "factor_cci"
            - "factor_wr"
            - "factor_obv"
          batch_size: 100
        dependencies: []

      - task_id: compute_fundamental_factors
        name: "Compute Fundamental Factors"
        task_type: factor_compute
        priority: normal
        timeout_seconds: 1800
        max_retries: 2
        params:
          factor_ids:
            - "factor_value_pe"
            - "factor_dividend_yield"
            - "factor_quality_roe"
          batch_size: 100
        dependencies: []

  factor_compute_historical:
    name: "Historical Factor Computation"
    description: "Calculate factors for historical data (2 years)"
    enabled: true
    schedule:
      type: manual
    max_concurrent_tasks: 2
    timeout_seconds: 14400
    tasks:
      - task_id: compute_all_factors
        name: "Compute All Factors"
        task_type: factor_compute
        priority: high
        timeout_seconds: 14400
        max_retries: 2
        params:
          batch_size: 50
        dependencies: []

  fundamental_data_sync:
    name: "Fundamental Data Sync"
    description: "Sync fundamental financial data (income statement, balance sheet, dividend)"
    enabled: true
    schedule:
      type: cron
      expression: "0 18 * * 1-5"
      timezone: "Asia/Shanghai"
    max_concurrent_tasks: 3
    timeout_seconds: 7200
    tasks:
      - task_id: collect_income_statement
        name: "Collect Income Statement"
        task_type: income_statement
        priority: high
        timeout_seconds: 1800
        max_retries: 3
        params:
          batch_size: 50
        dependencies: []

      - task_id: collect_balance_sheet
        name: "Collect Balance Sheet"
        task_type: balance_sheet
        priority: high
        timeout_seconds: 1800
        max_retries: 3
        params:
          batch_size: 50
        dependencies: []

      - task_id: collect_dividend_data
        name: "Collect Dividend Data"
        task_type: dividend_data
        priority: normal
        timeout_seconds: 1800
        max_retries: 3
        params:
          batch_size: 50
        dependencies: []

      - task_id: compute_fundamental_factors
        name: "Compute Fundamental Factors"
        task_type: fundamental_factor_compute
        priority: high
        timeout_seconds: 3600
        max_retries: 2
        params: {}
        dependencies:
          - collect_income_statement
          - collect_balance_sheet
          - collect_dividend_data

  fundamental_data_historical:
    name: "Historical Fundamental Data Sync"
    description: "One-time sync of all historical fundamental data"
    enabled: true
    schedule:
      type: manual
    max_concurrent_tasks: 2
    timeout_seconds: 14400
    tasks:
      - task_id: sync_income_statement
        name: "Sync All Income Statements"
        task_type: income_statement
        priority: high
        timeout_seconds: 3600
        max_retries: 3
        params:
          batch_size: 50
        dependencies: []

      - task_id: sync_balance_sheet
        name: "Sync All Balance Sheets"
        task_type: balance_sheet
        priority: high
        timeout_seconds: 3600
        max_retries: 3
        params:
          batch_size: 50
        dependencies: []

      - task_id: sync_dividend_data
        name: "Sync All Dividend Data"
        task_type: dividend_data
        priority: normal
        timeout_seconds: 3600
        max_retries: 3
        params:
          batch_size: 50
        dependencies: []

      - task_id: compute_all_fundamental_factors
        name: "Compute All Fundamental Factors"
        task_type: fundamental_factor_compute
        priority: high
        timeout_seconds: 7200
        max_retries: 2
        params: {}
        dependencies:
          - sync_income_statement
          - sync_balance_sheet
          - sync_dividend_data
